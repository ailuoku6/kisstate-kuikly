
# kisstate for Kuikly

**kisstate** æ˜¯ä¸€ä¸ªéµå¾ª **KISSï¼ˆKeep It Simple, Stupidï¼‰åŸåˆ™** çš„è½»é‡çº§å“åº”å¼çŠ¶æ€ç®¡ç†åº“ï¼Œ
ä¸º **Kuikly** æ¡†æ¶é‡èº«è®¾è®¡ã€‚

å®ƒæä¾›äº†ç±»ä¼¼ **Vue / React Hooks** çš„å“åº”å¼èƒ½åŠ›ï¼Œé€šè¿‡ `kisstate`ã€`computed`ã€`watch` ç­‰ APIï¼Œ
è®©ä½ å¯ä»¥ç”¨**æå°‘çš„å¿ƒæ™ºè´Ÿæ‹…**å®ŒæˆçŠ¶æ€ç®¡ç†ã€æ´¾ç”ŸçŠ¶æ€å’Œå‰¯ä½œç”¨ç›‘å¬ã€‚

---

## ç‰¹æ€§ âœ¨

* **æç®€ API**ï¼š`kisstate / kisstateList / computed / watch`
* **å“åº”å¼è‡ªåŠ¨è¿½è¸ª**ï¼šçŠ¶æ€å˜åŒ– â†’ UI è‡ªåŠ¨åˆ·æ–°
* **Kuikly æ·±åº¦é€‚é…**ï¼šä¸ `vfor` `vif` ç­‰æŒ‡ä»¤ ã€Page ç”Ÿå‘½å‘¨æœŸæ— ç¼åä½œ
* **æ— ä¾µå…¥å¼è®¾è®¡**ï¼šä¸éœ€è¦ç»§æ‰¿åŸºç±»ï¼Œä¸æ±¡æŸ“ä¸šåŠ¡æ¨¡å‹
* **æ˜¾å¼ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šé€šè¿‡ `KisContext` é¿å…å†…å­˜æ³„æ¼

---

## å®‰è£… ğŸ“¦

```kotlin
implementation("com.ailuoku6:kuikly-kisstate:latest-version")
```

> ç‰ˆæœ¬å·ä»¥å®é™…å‘å¸ƒä¸ºå‡†

---

## æ ¸å¿ƒæ¦‚å¿µ ğŸ§ 

### 1ï¸âƒ£ å“åº”å¼çŠ¶æ€ï¼ˆkisstateï¼‰

ä½¿ç”¨ `kisstate` å£°æ˜ä¸€ä¸ª**å¯è§‚å¯Ÿçš„åŸºç¡€çŠ¶æ€**ï¼š

```kotlin
class Counter {
    var count by kisstate(0)
}
```

* è‡ªåŠ¨è¿½è¸ª `count` çš„è¯»å–ä¸ä¿®æ”¹
* åœ¨ UIã€computedã€watch ä¸­ä½¿ç”¨éƒ½ä¼šå»ºç«‹ä¾èµ–

---

### 2ï¸âƒ£ å“åº”å¼åˆ—è¡¨ï¼ˆkisstateListï¼‰

åˆ—è¡¨æ˜¯ Kuikly åœºæ™¯ä¸­æœ€å¸¸è§çš„çŠ¶æ€ä¹‹ä¸€ï¼Œä½¿ç”¨ `kisstateList`ï¼š

```kotlin
class Counter {
    var list by kisstateList<String>()
}
```

æ”¯æŒï¼š

* `add / remove / clear` ç­‰æ•°ç»„æ–¹æ³•
* è‡ªåŠ¨è§¦å‘ `vfor` åˆ·æ–°
* å¯è¢« `computed` / `watch` ä¾èµ–

åœ¨ `vfor` ä¸­ä½¿ç”¨æ—¶ï¼š

```kotlin
vfor({ counter.list.toObservableList() }) { item ->
    Text {
        attr { text(item) }
    }
}
```

---

### 3ï¸âƒ£ è®¡ç®—å±æ€§ï¼ˆcomputedï¼‰

`computed` ç”¨äºå£°æ˜**æ´¾ç”ŸçŠ¶æ€**ï¼Œåªåœ¨ä¾èµ–å˜åŒ–æ—¶é‡æ–°è®¡ç®—ã€‚

```kotlin
val kisContext = KisContext()

val doubleCount by computed(kisContext) {
    counter.count * 2
}

val listLen by computed(kisContext) {
    counter.list.size
}
```

ç‰¹ç‚¹ï¼š

* è‡ªåŠ¨ä¾èµ–æ”¶é›†
* å…·å¤‡ç¼“å­˜èƒ½åŠ›
* ä¾èµ–å˜åŒ–æ‰é‡æ–°è®¡ç®—

âš ï¸ `computed` **å¿…é¡»ç»‘å®šåˆ° `KisContext`**

---

### 4ï¸âƒ£ å‰¯ä½œç”¨ç›‘å¬ï¼ˆwatchï¼‰

ä½¿ç”¨ `watch` ç›‘å¬çŠ¶æ€å˜åŒ–å¹¶æ‰§è¡Œå‰¯ä½œç”¨é€»è¾‘ï¼š

```kotlin
// ç›‘å¬kisstate
watch(kisContext, { counter.count }) { newV, preV ->
   println("kissLog count change: ${newV}")
}
// ç›‘å¬kisstateList
watch(kisContext, { counter.list }){ newV, preV ->
   println("kissLog list change: ${newV}")
}
// ç›‘å¬computedå€¼
watch(kisContext, { doudleCount }){ newV, preV ->
   println("kissLog doudleCount change: ${newV}")
}
// ç›‘å¬å¤šä¸ªå˜é‡
watch(kisContext, {
   listOf(counter.count ,counter.list)
}) { newV, preV ->
   println("kissLog count or list change: ${newV}")
}
```

* æ”¯æŒç›‘å¬ `kisstate` 
* æ”¯æŒç›‘å¬ `kisstateList`
* æ”¯æŒç›‘å¬ `computed`
* æä¾› `newValue / oldValue`

---

## å®Œæ•´ç¤ºä¾‹ ğŸš€

```kotlin
class Counter {
    var count by kisstate(0)
    var list by kisstateList<String>()
}

val counter = Counter()

@Page("router", supportInLocal = true)
internal class RouterPage : BasePager() {

    private val kisContext = KisContext()

    val doubleCount by computed(kisContext) {
        counter.count * 2
    }

    val listLen by computed(kisContext) {
        counter.list.size
    }

    override fun body(): ViewBuilder = {
        View {
            attr {
                flex(1f)
                allCenter()
            }

            Text { attr { text("count: ${counter.count}") } }
            Text { attr { text("double count: $doubleCount") } }
            Text { attr { text("list length: $listLen") } }

            Button {
                attr { titleAttr { text("add") } }
                event {
                    click {
                        counter.list.add("item: ${counter.count}")
                        counter.count++
                    }
                }
            }

            Text { attr { text("list:") } }

           // éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ vfor ä¸­ä½¿ç”¨kisstateListï¼Œéœ€è¦è°ƒç”¨toObservableListè¿”å›åŸå§‹çš„ObservableListå¯¹è±¡
            vfor({ counter.list.toObservableList() }) { item ->
                Text { attr { text(item) } }
            }
        }
    }

   fun initEffect() {
      // ç›‘å¬kisstate
      watch(kisContext, { counter.count }) { newV, preV ->
         println("kissLog count change: ${newV}")
      }
      // ç›‘å¬kisstateList
      watch(kisContext, { counter.list }){ newV, preV ->
         println("kissLog list change: ${newV}")
      }
      // ç›‘å¬computedå€¼
      watch(kisContext, { doudleCount }){ newV, preV ->
         println("kissLog doudleCount change: ${newV}")
      }
      // ç›‘å¬å¤šä¸ªå˜é‡
      watch(kisContext, {
         listOf(counter.count ,counter.list)
      }) { newV, preV ->
         println("kissLog count or list change: ${newV}")
      }
   }

    override fun created() {
        super.created()
        initEffect()
    }

    override fun pageWillDestroy() {
        super.pageWillDestroy()
        // âš ï¸ éå¸¸é‡è¦ï¼šé‡Šæ”¾æ‰€æœ‰ computed / watch
        kisContext.dispose()
    }
}
```

---

## ç”Ÿå‘½å‘¨æœŸç®¡ç† âš ï¸ï¼ˆéå¸¸é‡è¦ï¼‰

`computed` å’Œ `watch` **ä¸ä¼šè‡ªåŠ¨é”€æ¯**ï¼Œ
å¿…é¡»åœ¨ Page / Component é”€æ¯æ—¶æ‰‹åŠ¨é‡Šæ”¾ï¼š

```kotlin
override fun pageWillDestroy() {
    kisContext.dispose()
    super.pageWillDestroy()
}
```

å¦åˆ™å¯èƒ½å¯¼è‡´ï¼š

* å†…å­˜æ³„æ¼
* å·²é”€æ¯é¡µé¢ä»ç„¶å“åº”çŠ¶æ€å˜åŒ–

---

## è®¾è®¡ç†å¿µ ğŸ”§

* **æ˜¾å¼ä¾èµ–ï¼Œè€Œéé­”æ³•**
* **Context å³ä½œç”¨åŸŸ**
* **çŠ¶æ€ â‰  UI**
* **å“åº”å¼ä½†å¯æ§**

kisstate ä¸è¯•å›¾â€œæ¥ç®¡ä¸€åˆ‡â€ï¼Œ
å®ƒåªè´Ÿè´£ **çŠ¶æ€ â†’ å“åº” â†’ é€šçŸ¥** è¿™ä¸€ä»¶äº‹ã€‚

---

## æœ€ä½³å®è·µ âœ…

1. **ä¸šåŠ¡çŠ¶æ€å•ä¾‹åŒ–**

   ```kotlin
   val counter = Counter()
   ```

2. **Page / Component å†…åˆ›å»º KisContext**

3. **computed / watch å…¨éƒ¨ç»‘å®šåˆ° context**

4. **ç”Ÿå‘½å‘¨æœŸç»“æŸåŠæ—¶ dispose**

5. **çŠ¶æ€ä¸ UI è§£è€¦ï¼Œæ–¹ä¾¿å¤ç”¨ä¸æµ‹è¯•**

---

## API ä¸€è§ˆ ğŸ“–

| API            | è¯´æ˜           |
| -------------- | ------------ |
| `kisstate`     | åŸºç¡€å“åº”å¼çŠ¶æ€      |
| `kisstateList` | å“åº”å¼åˆ—è¡¨        |
| `computed`     | è®¡ç®—å±æ€§         |
| `watch`        | çŠ¶æ€ç›‘å¬         |
| `KisContext`   | ä½œç”¨åŸŸ & ç”Ÿå‘½å‘¨æœŸç®¡ç† |

---

## License

MIT Â© ailuoku6

---

ğŸ‰ **è®© Kuikly çš„çŠ¶æ€ç®¡ç†å›å½’ç®€å•ï¼**
kisstate ä¸è¿½æ±‚â€œå…¨èƒ½â€ï¼Œåªè¿½æ±‚**å¥½ç†è§£ã€å¥½ç”¨ã€ä¸å‘**ã€‚
